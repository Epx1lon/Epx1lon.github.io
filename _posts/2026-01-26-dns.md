---
title: DNS Server
author: epx1lon
date: 2026-01-26 00:34:00 +0800
categories: [Network, Servicios]
tags: [dns,bind9, axfr]
---

El Sistema de nombres de dominio (DNS) es una parte integral de Internet. Por ejemplo, a través de nombres de dominio, como google.com o facebook.com, podemos acceder a los servidores web a los que el proveedor de alojamiento ha asignado una o más direcciones IP específicas. El DNS es un sistema para resolver nombres de computadoras en direcciones IP y no tiene una base de datos central.

## Tipos de servidores DNS

| Tipo de servidor | Descripción |
| ------- | --------------|
| **DNS Root Server** | Los servidores DNS raíz son responsables de los dominios de nivel superior (TLD).<br>Como última instancia, solo se les solicita si el servidor de nombres no responde. <br>La ICANN coordina el trabajo de los servidores DNS raíz. <br>Hay 13 servidores raíz de este tipo en todo el mundo. |
| **Authoritative Nameserver**     | Los servidores DNS autoritativos tienen autoridad sobre una zona concreta. <br>Solo responden a consultas de su área de responsabilidad y su información es <br>vinculante. Si un servidor de nombres autoritativo no puede responder a la <br>consulta de un cliente, el servidor de nombres raíz toma el relevo en ese <br>momento. En función del país, la empresa, etc., los servidores DNS autoritativos <br>proporcionan respuestas a los servidores  DNS recursivos, lo que ayuda a <br>encontrar los servidores web específicos. |
| **Non-authoritative Nameserver** | Los servidores DNS no autoritativos no son responsables de una zona DNS <br>concreta. En su lugar, recopilan información sobre zonas DNS específicas por sí <br>mismos, lo que se realiza mediante consultas DNS recursivas o iterativas.  |
| **Caching DNS Server**           | Los servidores DNS almacenan en caché la información de otros servidores de <br>nombres durante un período determinado. El servidor DNS autoritativo <br>determina la duración de este almacenamiento. |
| **Forwarding Server**            | Los servidores de reenvío solo realizan una función: reenvían las consultas DNS <br>a otro servidor DNS. |
| **Resolver**                     | Los resolutores no son servidores DNS autoritativos, sino que realizan la <br>resolución de nombres localmente en el ordenador o en el router. |

<!-- markdownlint-disable-next-line -->
>  El servidor  DNS no solo vincula nombres de ordenadores y direcciones IP. También almacena y muestra información adicional sobre los servicios asociados a un dominio. Por lo tanto, una consulta DNS también se puede utilizar, por ejemplo, para determinar qué ordenador sirve como servidor de correo electrónico para el dominio en cuestión o cómo se llaman los servidores de nombres del dominio.
{: .prompt-info }


## Registros DNS

Se utilizan diferentes registros DNS para las consultas DNS, cada uno de los cuales tiene diversas tareas. 

| Registro DNS | Descripción |
|-------------|-------------|
| **A** | Devuelve una dirección IPv4 del dominio solicitado como resultado. |
| **AAAA** | Devuelve una dirección IPv6 del dominio solicitado. |
| **MX** | Devuelve los servidores de correo responsables como resultado. |
| **NS** | Devuelve los servidores DNS del dominio. |
| **TXT** | Este registro puede contener diversa información. El todoterreno se puede utilizar, por ejemplo, <br>para validar Google Search Console o validar certificados SSL. Además, las entradas SPF y DMARC <br>se configuran para validar el tráfico de correo y protegerlo del spam. |
| **CNAME** | Este registro sirve como alias para otro nombre de dominio. |
| **PTR** | El registro PTR funciona al revés (búsqueda inversa). Convierte direcciones IP en nombres de <br>dominio válidos. |
| **SOA** | Proporciona información sobre la zona DNS correspondiente y la dirección de correo electrónico <br>del contacto administrativo. |


## Configuración de un sevidor DNS Bind9

Existen muchos tipos diferentes de configuración para el DNS. Todos los servidores DNS funcionan con tres tipos diferentes de archivos de configuración:

- `Archivos de configuración DNS local`{: .filepath}
- `Archivos de zona`{: .filepath}
- `Archivos de resolución de nombres inversa`{: .filepath}

El `servidor DNS Bind9` se utiliza muy a menudo en distribuciones basadas en Linux. Su archivo de configuración local (`named.conf`) se divide a grandes rasgos en dos secciones: en primer lugar, la `sección de opciones` para la configuración general y, en segundo lugar, las `entradas de zona` para los dominios individuales. Los archivos de configuración locales suelen ser:

- `named.conf.local`{: .filepath}
- `named.conf.options`{: .filepath}
- `named.conf.log`{: .filepath}

El archivo de configuración `named.conf` se divide en varias opciones que controlan el comportamiento del servidor de nombres. Se distingue entre opciones globales y opciones de zona.

El archivo `/etc/bind/named.conf.options` define quién puede hacer consultas y a qué servidores externos (forwarders) acudir si nuestro servidor no conoce una dirección.

```bash
root@bind9:~# cat /etc/bind/named.conf.options

acl "trusted" {
        127.0.0.0/8;
        192.168.1.0/24;  # Red permitida para solicitudes DNS
};

options {
        directory "/var/cache/bind";

        recursion yes;
        allow-query { trusted; };

        forwarders {
                8.8.8.8;
                1.1.1.1;
        };

        dnssec-validation auto;
        listen-on-v6 { any; };
};
```

Debemos decirle a BIND qué dominios vamos a manejar. Esto se hace en `/etc/bind/named.conf.local`. En este archivo podemos definir las diferentes zonas. Estas zonas se dividen en archivos individuales, que en la mayoría de los casos están destinados principalmente a un solo dominio. Las excepciones son los servidores DNS públicos y de ISP. Además, hay muchas opciones diferentes que amplían o reducen la funcionalidad.

```bash
root@bind9:~# cat /etc/bind/named.conf.local

zone "empresa.local" {
    type master;
    file "/etc/bind/zones/db.empresa.local"; # Ruta al archivo de zona directa
};

zone "1.168.192.in-addr.arpa" {
    type master;
    file "/etc/bind/zones/db.192.168.1";     # Zona de búsqueda inversa
};
```

Un archivo de zona es un archivo de texto que describe una zona DNS con el formato de archivo BIND. El formato de archivo BIND es el formato de archivo de zona preferido por la industria y ahora está bien establecido en el software de servidor DNS. Un archivo de zona describe una zona por completo. Debe haber exactamente un registro SOA y al menos un registro NS.

El registro de recursos SOA suele estar situado al principio de un archivo de zona. El objetivo principal de estas reglas globales es mejorar la legibilidad de los archivos de zona. Un error de sintaxis suele dar lugar a que todo el archivo de zona se considere inutilizable. El servidor de nombres se comporta de forma similar a como lo haría si esta zona no existiera. Responde a las consultas DNS con un mensaje de error SERVFAIL.

En resumen, aquí todos los registros de reenvío se introducen según el formato BIND. Esto permite al servidor DNS identificar a qué dominio, nombre de host y función pertenecen las direcciones IP. En términos sencillos, se trata de la guía telefónica en la que el servidor DNS busca las direcciones de los dominios que está buscando.

Configuramos el archivo de zona directa, `/etc/bind/zones/db.empresa.local`, de la siguiente manera:

```bash
root@bind9:~# cat /etc/bind/zones/db.empresa.local

;
; BIND data file for empresa.local
;
$TTL    604800
@       IN      SOA     ns1.empresa.local. admin.empresa.local. (
                     2026020701         ; Serial (Formato: YYYYMMDDNN)
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                         604800 )       ; Negative Cache TTL
;
@       IN      NS      ns1.empresa.local.
ns1     IN      A       192.168.1.10    ; IP del servidor DNS
blog    IN      A       192.168.1.20    ; IP del blog
tienda    IN      A     192.168.1.30    ; IP de la tienda online

```

Luego configuramos el archivo de zona inversa `/etc/bind/zones/db.192.168.1`

```bash
root@bind9:~# cat /etc/bind/zones/db.192.168.1

$TTL    604800
@       IN      SOA     ns1.empresa.local. admin.empresa.local. (
                     2026020701         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                         604800 )       ; Negative Cache TTL
;
@       IN      NS      ns1.empresa.local.
10      IN      PTR     ns1.empresa.local.
20      IN      PTR     blog.empresa.local.
20      IN      PTR     tienda.empresa.local.

```

## Configuraciones peligrosas

Hay muchas formas en las que un servidor DNS puede ser atacado. Por ejemplo, en [CVEdetails](https://www.cvedetails.com/product/144/ISC-Bind.html?vendor_id=64) se puede encontrar una lista de vulnerabilidades dirigidas al servidor BIND9. Además, SecurityTrails ofrece una breve [lista](https://web.archive.org/web/20250329174745/https://securitytrails.com/blog/most-popular-types-dns-attacks) de los ataques más comunes a los servidores DNS.

Algunas de las configuraciones que podemos ver a continuación dan lugar a estas vulnerabilidades, entre otras. Dado que el DNS puede ser muy complicado y es muy fácil que se cuelen errores en este servicio, el administrador se ve obligado a buscar soluciones provisionales hasta encontrar la solución definitiva. Esto suele dar lugar a que se liberen elementos para que partes de la infraestructura funcionen según lo previsto y deseado. En tales casos, la funcionalidad tiene mayor prioridad que la seguridad, lo que da lugar a configuraciones erróneas y vulnerabilidades.


| Opción | Descripción |
|-------------|-------------|
| **allow-query** | Define qué hosts pueden enviar solicitudes al servidor DNS. |
| **allow-query** | Define qué hosts pueden enviar solicitudes recursivas al servidor DNS. |
| **allow-transfer** |Define qué hosts pueden recibir transferencias de zona del servidor DNS.|
| **zone-statistics** | Recopila datos estadísticos de las zonas. |

## Transferencia de zona

La transferencia de zona se refiere a la transferencia de zonas a otro servidor en DNS, lo que generalmente ocurre a través del puerto TCP 53. Este procedimiento se abrevia como Transferencia de zona completa asíncrona (AXFR). Dado que un fallo de DNS suele tener graves consecuencias para una empresa, el archivo de zona se mantiene casi siempre idéntico en varios servidores DNS. Cuando se realizan cambios, hay que asegurarse de que todos los servidores tengan los mismos datos. La sincronización entre los servidores implicados se realiza mediante la transferencia de zona. La transferencia de zona implica la mera transferencia de archivos o registros y la detección de discrepancias en los conjuntos de datos de los servidores implicados.

Los datos originales de una zona se encuentran en un servidor DNS, que se denomina servidor DNS primario para esta zona. Sin embargo, para aumentar la fiabilidad, realizar una distribución de carga sencilla o proteger el primario de ataques, en la práctica se instalan en casi todos los casos uno o varios servidores adicionales, que se denominan servidores DNS secundarios para esta zona. Para algunos dominios de nivel superior (TLD), es obligatorio que los archivos de zona para los dominios de segundo nivel sean accesibles en al menos dos servidores.

Por lo general, las entradas DNS solo se crean, modifican o eliminan en el servidor principal. Un servidor DNS que sirve como fuente directa para sincronizar un archivo de zona se denomina maestro. Un servidor DNS que obtiene datos de zona de un maestro se denomina esclavo. Un servidor principal es siempre un maestro, mientras que un servidor secundario puede ser tanto esclavo como maestro.

El esclavo obtiene el registro SOA de la zona relevante del maestro a intervalos determinados, el llamado tiempo de actualización, normalmente una hora, y compara los números de serie. Si el número de serie del registro SOA del maestro es mayor que el del esclavo, los conjuntos de datos ya no coinciden.

Si el administrador utilizara una subred para la opción «allow-transfer» con fines de prueba o como solución alternativa, o la configurara como «any», todo el mundo consultaría el archivo de zona completo en el servidor DNS. Además, se podrían consultar otras zonas, lo que podría incluso mostrar direcciones IP internas y nombres de host.

```bash
> dig axfr internal.inlanefreight.htb @10.129.14.128

; <<>> DiG 9.16.1-Ubuntu <<>> axfr internal.inlanefreight.htb @10.129.14.128
;; global options: +cmd
internal.inlanefreight.htb. 604800 IN   SOA     inlanefreight.htb. root.inlanefreight.htb. 2 604800 86400 2419200 604800
internal.inlanefreight.htb. 604800 IN   TXT     "MS=ms97310371"
internal.inlanefreight.htb. 604800 IN   TXT     "atlassian-domain-verification=t1rKCy68JFszSdCKVpw64A1QksWdXuYFUeSXKU"
internal.inlanefreight.htb. 604800 IN   TXT     "v=spf1 include:mailgun.org include:_spf.google.com include:spf.protection.outlook.com include:_spf.atlassian.net ip4:10.129.124.8 ip4:10.129.127.2 ip4:10.129.42.106 ~all"
internal.inlanefreight.htb. 604800 IN   NS      ns.inlanefreight.htb.
dc1.internal.inlanefreight.htb. 604800 IN A     10.129.34.16
dc2.internal.inlanefreight.htb. 604800 IN A     10.129.34.11
mail1.internal.inlanefreight.htb. 604800 IN A   10.129.18.200
ns.internal.inlanefreight.htb. 604800 IN A      10.129.34.136
vpn.internal.inlanefreight.htb. 604800 IN A     10.129.1.6
ws1.internal.inlanefreight.htb. 604800 IN A     10.129.1.34
ws2.internal.inlanefreight.htb. 604800 IN A     10.129.1.35
wsus.internal.inlanefreight.htb. 604800 IN A    10.129.18.2
internal.inlanefreight.htb. 604800 IN   SOA     inlanefreight.htb. root.inlanefreight.htb. 2 604800 86400 2419200 604800
;; Query time: 0 msec
;; SERVER: 10.129.14.128#53(10.129.14.128)
;; WHEN: So Sep 19 18:53:11 CEST 2021
;; XFR size: 15 records (messages 1, bytes 664)
```
