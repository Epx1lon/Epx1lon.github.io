---
title: SMB Server
author: epx1lon
date: 2026-01-28 00:34:00 +0800
categories: [Network, Servicios]
tags: [smb,samba]
---

Server Message Block (SMB) es un protocolo cliente-servidor que regula el acceso a archivos y directorios completos, así como a otros recursos de red, como impresoras, enrutadores o interfaces liberadas para la red. El intercambio de información entre diferentes procesos del sistema también se puede gestionar basándose en el protocolo SMB. El SMB se puso a disposición de un público más amplio, por ejemplo, como parte del sistema operativo de red OS/2 LAN Manager y LAN Server. Desde entonces, el principal ámbito de aplicación del protocolo ha sido la serie de sistemas operativos Windows, cuyos servicios de red son compatibles con SMB de forma descendente, lo que significa que los dispositivos con ediciones más recientes pueden comunicarse fácilmente con dispositivos que tienen instalado un sistema operativo Microsoft más antiguo. Con el proyecto de software libre Samba, también existe una solución que permite el uso de SMB en distribuciones Linux y Unix y, por lo tanto, la comunicación entre plataformas a través de SMB.

## Samba

Los sistemas operativos <span style="color:rgb(255, 255, 0)">LINUX</span> y <span style="color:rgb(255, 255, 0)">UNIX</span> también proporcionan un método para compartir recursos con las redes Microsoft a través de una versión de SMB denominada <span style="color:rgb(255, 255, 0)">SAMBA</span>.

Básicamente **<span style="color:rgb(255, 255, 0)">samba</span>** permite a PCs que utilizan Linux, conectarse a carpetas compartidas en PCs con Windows y compartir carpetas como si de un sistema Windows se tratara. Gracias a **samba**, en una red podemos tener PCs con Windows y PCs con Linux de forma que puedan intercambiar información en carpetas compartidas de la misma forma que se haría si todos los PCs fueran Windows.

Inicialmente <span style="color:rgb(255, 255, 0)">SMB dependía de NetBios</span> para funcionar, <span style="color:rgb(255, 255, 0)">NetBios permite</span> que los dispositivos en la red puedan "descubrirse" entre sí y <span style="color:rgb(255, 255, 0)">compartir recursos</span> como archivos e impresoras, usando nombres fáciles de entender (en lugar de direcciones IP), las conexiones generalmente ocurren a través de <span style="color:rgb(255, 255, 0)">puertos TCP 137, 138, y 139</span>.

**Hoy en día**, <span style="color:rgb(255, 255, 0)">SMB ya no necesita NetBIOS</span> para operar. En redes modernas, SMB puede trabajar directamente sobre <span style="color:rgb(255, 255, 0)">TCP/IP utilizando el puerto 445</span>, sin requerir NetBIOS.



## Configuración del servidor samba

Actualizamos e instalamos los paquetes:

```bash
sudo apt update
sudo apt install samba smbclient
```
Preparamos el directorio que queremos compartir. No usaremos la carpeta /home de un usuario para evitar problemas de permisos, sino un directorio dedicado en /srv. Y creamos un grupo para usuarios de Samba: Esto permite gestionar permisos de forma escalable.

```bash
sudo mkdir -p /srv/samba/privado
sudo groupadd smbgroup

sudo chown :smbgroup /srv/samba/privado
sudo chmod 2770 /srv/samba/privado
```
Samba mantiene su propia base de datos de contraseñas, separada de la de Linux. El usuario debe existir en el sistema Linux primero, pero la contraseña de Samba puede ser diferente.

```bash
sudo adduser smbuser
sudo smbpasswd -a smbuser
sudo usermod -aG smbgroup usuario_smb
```

Y por ultimo configuramos el archivo `/etc/samba/smb.conf`

```bash
[SeguridadPrivada]
   comment = Servidor smb 
   path = /srv/samba/privado
   read only = no
   browsable = yes
   valid users = @smbgroup
   force group = smbgroup
   create mask = 0660
   directory mask = 0770
   # Deshabilitamos SMBv1 (vulnerable a WannaCry/EternalBlue)
   server min protocol = SMB2
```

Reiniciamos el servicio para aplicar cambios:

```bash
sudo systemctl restart smbd
sudo systemctl restart nmbd
```

Existen muchas otras configuraciones para los recursos compartidos en Samba.

| Configuración                                                            | Descripción                                                                          |
| ------------------------------------------------------------------------ | ------------------------------------------------------------------------------------ |
| <span style="color:rgb(255, 255, 0)">[sharename]</span>                  | Nombre del recurso compartido de red.                                                |
| <span style="color:rgb(255, 255, 0)">workgroup= WORKGROUP/DOMAIN</span>  | Grupo de trabajo que aparecerá cuando los clientes consulten.                        |
| <span style="color:rgb(255, 255, 0)">path = /path/here/</span>           | El directorio al que se le dará acceso al usuario.                                   |
| <span style="color:rgb(255, 255, 0)">server string = STRING</span>       | La cadena que aparecerá cuando se inicie una conexión.                               |
| <span style="color:rgb(255, 255, 0)">unix password sync = yes</span>     | ¿Sincronizar la contraseña UNIX con la contraseña SMB?                               |
| <span style="color:rgb(255, 255, 0)">usershare allow guests = yes</span> | ¿Permitir que los usuarios no autenticados accedan a recursos compartidos definidos? |
| <span style="color:rgb(255, 255, 0)">browseable = yes</span>             | ¿Debería mostrarse esta acción en la lista de recursos compartidos disponibles?      |
| <span style="color:rgb(255, 255, 0)">guest ok = yes</span>               | ¿Permitir conectarse al servicio sin usar una contraseña?                            |
| <span style="color:rgb(255, 255, 0)">read only = yes</span>              | ¿Permitir a los usuarios leer solo archivos?                                         |
| <span style="color:rgb(255, 255, 0)">create mask = 0700</span>           | ¿Qué permisos deben establecerse para los archivos recién creados?                   |


## Configuraciones peligrosas

Algunas de las configuraciones anteriores ya incluyen algunas opciones delicadas. Sin embargo, supongamos que cuestionamos las configuraciones que se enumeran a continuación y nos preguntamos qué podrían ganar los empleados con ellas, así como los atacantes. En ese caso, veremos qué ventajas y desventajas traen consigo las configuraciones. Tomemos como ejemplo la configuración `browseable = yes`. Si nosotros, adoptamos esta configuración, los empleados de la empresa tendrán la comodidad de poder ver las carpetas individuales con su contenido. Muchas carpetas se utilizan finalmente para mejorar la organización y la estructura. Si el empleado puede navegar por los recursos compartidos, el atacante también podrá hacerlo tras acceder con éxito.

| Configuración                                                         | Descripción                                                     |
| --------------------------------------------------------------------- | --------------------------------------------------------------- |
| <span style="color:rgb(255, 255, 0)">browseable = yes</span>          | ¿Permitir enumerar los recursos compartidos disponibles?        |
| <span style="color:rgb(255, 255, 0)">read only = no</span>            | ¿Permitir a los usuarios leer solo archivos?                    |
| <span style="color:rgb(255, 255, 0)">writable = yes</span>            | ¿Permitir a los usuarios crear y modificar archivos?            |
| <span style="color:rgb(255, 255, 0)">guest ok = yes</span>            | ¿Permitir conectarse al servicio sin usar una contraseña?       |
| <span style="color:rgb(255, 255, 0)">enable privileges = yes</span>   | ¿Privilegios de honor asignados a SID específicos?              |
| <span style="color:rgb(255, 255, 0)">create mask = 0777</span>        | ¿Qué permisos se deben asignar a los archivos recién creados?   |
| <span style="color:rgb(255, 255, 0)">directory mask = 0777</span>     | ¿Qué permisos deben asignarse a los directorios recién creados? |
| <span style="color:rgb(255, 255, 0)">logon script = script.sh</span>  | ¿Qué script debe ejecutarse en el inicio de sesión del usuario? |
| <span style="color:rgb(255, 255, 0)">magic script = script.sh</span>  | ¿Qué script debe ejecutarse cuando se cierra el script?         |
| <span style="color:rgb(255, 255, 0)">magic output = script.out</span> | ¿Dónde se debe almacenar la salida del script mágico?           |




